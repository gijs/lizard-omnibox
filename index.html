<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Lizard 5 - Omnibox Spike</title>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
<link rel="stylesheet" href="omnibox.css" />
<link href="css/bootstrap.css" rel="stylesheet" />
<link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic|Roboto+Condensed:300italic,400italic,700italic,400,300,700|Roboto+Slab' rel='stylesheet' type='text/css'>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
<script src="js/keypress.js"></script>
<script src="js/oridomi.js"></script>
<script src="js/selectize.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/bootstrap-tabs.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<body>

<div id="omnibox">
    <div class="searchbox searchbox-shadow " id="searchbox" tabindex="-1" role="search" style="">
        <form id="searchbox_form"> 
            <table cellspacing="0" cellpadding="0" id="gs_id0" class="searchboxinput" style="width: 375px; padding: 0px;">
                <tbody>
                    <tr>
                        <td id="gs_tti0" class="gsib_a">
                            <input class="tactile-searchbox-input" aria-label="Search" id="searchboxinput" name="q" tabindex="1" autocomplete="off" dir="ltr" spellcheck="false" style="border: none; padding: 0px; margin: -0.0625em 0px 0px; height: 1.25em; width: 100%; outline: none;">
                        </td>
                        <td class="gsib_b">
                            <div class="gsst_b" id="gs_st0" dir="ltr">
                                <a class="gsst_a" href="javascript:void(0)" tabindex="2" style="display: none;">
                                    <span class="gscb_a" id="gs_cb0">Ã—</span>
                                </a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form> 
        <button class="searchbutton" aria-label="Search" onclick="addr_search();" tabindex="3"></button>
    </div>
    <div class="widget-directions" tabindex="-1" style="display:none;outline:none"></div>
    <div id="rap-card" tabindex="-1">
    </div> 

</div>

<div id="cards" class="cards-shadow" style="top: 48px; clip: rect(-10px 500px 2000px -10px); height: 116px; overflow: hidden;" tabindex="-1">

    <ul class="nav nav-tabs" id="omnitab">
      <li><a href="#apps" data-toggle="tab" onclick="javascript:setHeight(300);" title="Apps"><i class="icon-th icon-large"></i></a></li>
      <li><a href="#thema" data-toggle="tab" onclick="javascript:setHeight(230);" title="Themakaarten"><i class="icon-globe icon-large"></i></a></li>
      <li><a href="#legenda" data-toggle="tab" onclick="javascript:setHeight(160);" title="Legenda"><i class="icon-reorder icon-large"></i></a></li>
      <li><a href="#kaart" data-toggle="tab" onclick="javascript:setHeight(200);" title="Kaartlagen"><i class="icon-map-marker icon-large"></i></a></li>
      <li><a href="#instellingen" data-toggle="tab" onclick="javascript:setHeight(200);" title="Instellingen"><i class="icon-wrench icon-large"></i></a></li>
      <li><a href="#6" data-toggle="tab" onclick="javascript:setHeight(125);" title="3Di"><img src="img/3di-icon.png"></a></li>
    </ul>
    
    <div class="tab-content">
      <div class="tab-pane active" id="apps">
          
          <table cellpadding="5" cellspacing="5">
          <tr>
              <td><img src="http://placehold.it/80x80"></td>
              <td><img src="http://placehold.it/80x80"></td>
              <td><img src="http://placehold.it/80x80"></td>
          </tr>
          <tr>
              <td><img src="http://placehold.it/80x80"></td>
              <td><img src="http://placehold.it/80x80"></td>
              <td><img src="http://placehold.it/80x80"></td>
          </tr>
          </table>
          
          
      </div>
      <div class="tab-pane" id="thema">
            <table class="table">
              <tbody>
                <tr>
                  <td>Rioleringen</td>
                  <td><label><input type="checkbox" class="ios-switch hide" checked=""><div class="switch"></div></label></td>
                </tr>
                <tr>
                  <td>Dijken</td>
                  <td><label><input type="checkbox" class="ios-switch hide" checked=""><div class="switch"></div></label></td>
                </tr>
                <tr>
                  <td>Keringen</td>
                  <td><label><input type="checkbox" class="ios-switch hide" checked=""><div class="switch"></div></label></td>
                </tr>
              </tbody>
            </table>
      </div>
      <div class="tab-pane" id="legenda">
            <table class="table">
              <tbody>
                <tr>
                  <td><div style="position:relative;height:10px;width:10px;background-color:red;"></div></td>
                  <td>Druk (mU)</td>
                </tr>
                <tr>
                  <td><div style="position:relative;height:10px;width:10px;background-color:green;"></div></td>
                  <td>Temperatuur (C)</td>
                </tr>
              </tbody>
            </table>          
      </div>
      <div class="tab-pane" id="kaart">
          <div style="padding: 5px;">
            <label class="radio">
              <input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked>
              Google
            </label>
            <label class="radio">
              <input type="radio" name="optionsRadios" id="optionsRadios2" value="option2">
              OpenStreetMap
            </label>       
            <label class="radio">
              <input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked>
              Algemene Hoogtekaart (AHN2)
            </label>
            <label class="radio">
              <input type="radio" name="optionsRadios" id="optionsRadios2" value="option2">
              Satellite
            </label>        
          </div>              
          
      </div>      
      <div class="tab-pane" id="instellingen">
            <form class="">
              <div class="control-group">
                <label class="control-label" for="inputZoomTo">Standaard plaats of lat/lon</label>
                <div class="controls">
                  <input type="text" id="zoomtoplace" placeholder="Utrecht">
                </div>
              </div>
              <div class="control-group">
                <div class="controls">                  
                  <label><input type="checkbox" class="ios-switch hide" checked=""><div class="switch"></div>Pan/zoom animaties</label>
                </div>
              </div>
            </form>          
      </div>
      <div class="tab-pane" id="6">
      <button type="button" class="btn btn-success"><i class="icon-play"></i></button>
      <button type="button" class="btn btn-warning"><i class="icon-pause"></i></button>
      <button type="button" class="btn btn-danger"><i class="icon-stop"></i></button>
      </div>      
    </div>
</div>

<div id="results" class="results-shadow" style="top: 0px; clip: rect(-10px 500px 2000px -10px); height: 116px; overflow: hidden;" tabindex="-1">
</div>

<div id="map"></div>
<script>
    // Prevent console.log from throwing errors
    if(typeof(console) === 'undefined') {
        var console = {};
        console.log = console.error = console.info = console.debug = console.warn = console.trace = console.dir = console.dirxml = console.group = console.groupEnd = console.time = console.timeEnd = console.assert = console.profile = function() {};
    }

    window.addEventListener('shake', shakeEventDidOccur, false);

    function shakeEventDidOccur() {
        $('#searchboxinput').val("");
        $('#results').empty();
        $('#results').slideUp('fast');
        return true;
    }    

    function setHeight(val) {
        $('#cards').animate({height: val + 'px'}, 50, function(){
        $('#results').css('top', $('#cards').height() + 60 + 'px');  
        });
        
    }

    function addr_search() {
        var inp = document.getElementById("searchboxinput");

        $.getJSON('//nominatim.openstreetmap.org/search?format=json&limit=5&q=' + inp.value, function(data) {
            var items = [];
            // console.log(data);
            $.each(data, function(key, val) {
                bb = val.boundingbox;
                items.push("<li><a href='#' onclick='chooseAddr(" + bb[0] + ", " + bb[2] + ", " + bb[1] + ", " + bb[3]  + ", \"" + val.osm_type + "\");return false;'>" + val.display_name + '</a></li>');
            });

        $('#results').css('top', $('#cards').height() + 60 + 'px');
        $('#results').empty();
        $('#results').show();

            if (items.length != 0) {
                $('<ul/>', {
                    'class': 'my-new-list',
                    html: items.join('')
                }).appendTo('#results');
            } else {
                $('<p>', { html: "Niets gevonden..." }).appendTo('#results');
            }
        });
    }

    function chooseAddr(lat1, lng1, lat2, lng2, osm_type) {
      var loc1 = new L.LatLng(lat1, lng1);
      var loc2 = new L.LatLng(lat2, lng2);
      var bounds = new L.LatLngBounds(loc1, loc2);

      // if (feature) {
      //   map.removeLayer(feature);
      // }
      if (osm_type == "node") {
        feature = L.circle( loc1, 25, {color: 'green', fill: false}).addTo(map);
        map.fitBounds(bounds);
        map.setZoom(18);
      } else {
        var loc3 = new L.LatLng(lat1, lng2);
        var loc4 = new L.LatLng(lat2, lng1);

        feature = L.polyline( [loc1, loc4, loc2, loc3, loc1], {color: 'red'}).addTo(map);
        map.fitBounds(bounds);
      }
    }

    $(document).ready(function() {

        $('#searchbox_form').submit(function(e) {
          e.preventDefault();
          addr_search();
        })

        $('#results').hide();
        keypress.combo("ctrl h", function(e) {
            e.preventDefault();
            $('#cards').slideToggle('fast');
            if($('#results').is(':visible')) {
              $('#results').slideToggle('fast');
            }
        });

        keypress.combo("ctrl s", function(e) {
            e.preventDefault();
            $('#searchboxinput').focus();
        });

        // keypress.combo("1", function(e) {
        //     e.preventDefault();
        //     console.log("You pressed 1");
        //     $('#omnitab a:first').tab('show');
        // });

        // keypress.combo("2", function(e) {
        //     e.preventDefault();
        //     console.log("You pressed 2");
        //     $('#omnitab a:nth-of-type(1)').tab('show');
        // });

        // keypress.combo("3", function(e) {
        //     e.preventDefault();
        //     console.log("You pressed 3");
            
        // });

        // keypress.combo("4", function(e) {
        //     e.preventDefault();
        //     console.log("You pressed 4");
            
        // });

        // keypress.combo("5", function(e) {
        //     e.preventDefault();
        //     console.log("You pressed 5");
            
        // });                        

        // keypress.combo("6", function(e) {
        //     e.preventDefault();
        //     console.log("You pressed 6");
        //     $('#omnitab a:last').tab('show');
        // });              

        map = L.map(map, {'zoomControl': false}).setView([51.85953150985473,5.4327392578125], 13);
        // new L.Control.Zoom({
        //     'position': 'topright'
        // }).addTo(map);
        new L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        $('.nav-tabs').tab();
        $('#searchboxinput').focus();
        setHeight(300);
    });

</script>

</body>